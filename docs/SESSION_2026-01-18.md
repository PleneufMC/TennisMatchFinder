# Session de DÃ©veloppement â€” 18 janvier 2026

**DurÃ©e** : ~6 heures (2 sessions)  
**Objectif** : Corrections build Netlify + Nouveau logo + Notifications Push PWA  
**DÃ©veloppeur** : AI Assistant (Claude)

---

## RÃ©sumÃ© ExÃ©cutif

Session trÃ¨s productive avec **10 commits** majeurs poussÃ©s sur `main`. Les builds Netlify ont Ã©tÃ© corrigÃ©s, le branding a Ã©tÃ© mis Ã  jour avec un nouveau logo, et les notifications push PWA ont Ã©tÃ© implÃ©mentÃ©es.

### Commits de la Session

| Hash | Message | Impact |
|------|---------|--------|
| `a2de346` | fix(build): escape JSX entities for Netlify build | Build fix |
| `b58a81c` | feat: add rate limiting, Sentry monitoring, and E2E tests | SÃ©curitÃ© + Monitoring |
| `8d46960` | feat(branding): replace app logo with new green TMF logo | Nouveau branding |
| `fdf995b` | fix(build): exclude playwright config from TypeScript | Build fix |
| `50f0876` | feat(push): implement Web Push notifications | Engagement utilisateur |

---

## Partie 1 : Corrections Build Netlify âœ…

### ProblÃ¨mes IdentifiÃ©s

1. **Timeout /offline** : Server Component avec `onClick` (interactivitÃ© client)
2. **API /api/clubs/approve** : `request.url` nÃ©cessite `dynamic = 'force-dynamic'`
3. **ESLint** : ~50 erreurs `react/no-unescaped-entities` (apostrophes non Ã©chappÃ©es)
4. **Playwright** : `@playwright/test` non disponible en production (devDependency)

### Solutions AppliquÃ©es

| ProblÃ¨me | Solution | Fichiers |
|----------|----------|----------|
| Offline timeout | Conversion en Client Component + layout sÃ©parÃ© | `src/app/offline/page.tsx`, `layout.tsx` |
| API dynamic | `export const dynamic = 'force-dynamic'` | `src/app/api/clubs/approve/route.ts` |
| ESLint entities | Remplacement `'` â†’ `&apos;`, `"` â†’ `&quot;` | 18 fichiers |
| Playwright build | Exclusion dans `tsconfig.json` | `tsconfig.json` |

### Fichiers CorrigÃ©s (ESLint)

```
src/app/(dashboard)/help/page.tsx
src/app/(dashboard)/notifications/page.tsx
src/app/(dashboard)/tournaments/[tournamentId]/page.tsx
src/app/(dashboard)/tournaments/page.tsx
src/app/clubs/nouveau/page.tsx
src/components/admin/delete-club-button.tsx
src/components/auth/register-city-form.tsx
src/components/auth/register-form-city.tsx
src/components/clubs/club-creation-form.tsx
src/components/cookie-banner.tsx
src/components/matches/match-form.tsx
src/components/profile/profile-edit-form.tsx
src/components/reputation/rating-modal.tsx
src/components/tournaments/create-tournament-dialog.tsx
src/components/tournaments/participants-list.tsx
src/components/tournaments/tournament-bracket.tsx
```

---

## Partie 2 : FonctionnalitÃ©s Haute PrioritÃ© âœ…

### Rate Limiting

| Route | Quota | Fallback |
|-------|-------|----------|
| `/api/auth/register*` | 3 req / 5 min | MÃ©moire locale |
| `/api/matches` | 30 req / min | MÃ©moire locale |
| `/api/stripe/*` | 10 req / min | MÃ©moire locale |
| `/api/upload/avatar` | 5 req / min | MÃ©moire locale |

**Fichier crÃ©Ã©** : `src/lib/rate-limit.ts`

### Sentry Monitoring

| Fichier | RÃ´le |
|---------|------|
| `sentry.client.config.ts` | Configuration client-side |
| `sentry.server.config.ts` | Configuration server-side |
| `sentry.edge.config.ts` | Configuration Edge runtime |
| `src/instrumentation.ts` | Hook d'instrumentation |
| `src/app/global-error.tsx` | Page d'erreur personnalisÃ©e |

### Tests E2E Playwright

| Fichier | Tests |
|---------|-------|
| `e2e/home.spec.ts` | Page d'accueil, navigation |
| `e2e/auth.spec.ts` | Login, register, magic link |
| `e2e/api.spec.ts` | Endpoints API |
| `e2e/pricing.spec.ts` | Page tarifs |

---

## Partie 3 : Nouveau Logo âœ…

### Ancien Logo
- Emoji ğŸ¾ + texte "TMF"
- Couleur orange (`#f59e0b`)

### Nouveau Logo
- Cercle vert avec balle de tennis stylisÃ©e et ligne de progression
- Couleur verte (`#22c55e`)

### Fichiers CrÃ©Ã©s

| Fichier | Taille | Usage |
|---------|--------|-------|
| `public/images/logo.png` | 1.18 MB | Logo original |
| `public/images/icon-192.png` | 52 KB | PWA icon |
| `public/images/icon-512.png` | 254 KB | PWA icon HD |
| `public/favicon.ico` | 10 KB | Favicon navigateur |
| `public/favicon-16x16.png` | 811 B | Favicon petit |
| `public/favicon-32x32.png` | 2.4 KB | Favicon moyen |
| `public/apple-touch-icon.png` | 44 KB | iOS icon |

### Fichiers ModifiÃ©s

| Fichier | Modification |
|---------|-------------|
| `public/site.webmanifest` | IcÃ´nes PNG + thÃ¨me vert |
| `src/components/layout/sidebar.tsx` | Image + texte vert |
| `src/components/layout/mobile-nav.tsx` | Image + texte vert |
| `src/app/(auth)/layout.tsx` | Image + texte vert |
| `src/app/(public)/layout.tsx` | Image + texte vert (header + footer) |

---

## Partie 4 : Notifications Push PWA âœ…

### Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client Side   â”‚     â”‚   Server Side   â”‚     â”‚    Database     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ usePushNotif()  â”‚â”€â”€â”€â”€â–¶â”‚ /api/push/*     â”‚â”€â”€â”€â”€â–¶â”‚ push_subscript- â”‚
â”‚ PushToggle      â”‚     â”‚ sendPushToUser  â”‚     â”‚ ions            â”‚
â”‚ Service Worker  â”‚â—€â”€â”€â”€â”€â”‚ web-push lib    â”‚     â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Fichiers CrÃ©Ã©s

| Fichier | Lignes | RÃ´le |
|---------|--------|------|
| `src/lib/push/index.ts` | 320 | Service principal |
| `src/app/api/push/subscribe/route.ts` | 95 | API subscribe |
| `src/app/api/push/unsubscribe/route.ts` | 65 | API unsubscribe |
| `src/hooks/use-push-notifications.ts` | 200 | Hook React |
| `src/components/push/push-notification-toggle.tsx` | 210 | Composants UI |

### Types de Notifications

| Type | Trigger | Message |
|------|---------|---------|
| `matchRecorded` | Nouveau match enregistrÃ© | "X a enregistrÃ© un match avec vous" |
| `matchConfirmed` | Match confirmÃ© | "X a confirmÃ© votre match" |
| `matchRejected` | Match contestÃ© | "X a contestÃ© le rÃ©sultat" |
| `newMessage` | Message chat | "Message de X" |
| `matchNow` | Match Now disponibilitÃ© | "X cherche un partenaire" |
| `tournamentOpen` | Inscriptions ouvertes | "Inscriptions pour X ouvertes" |
| `badgeEarned` | Badge dÃ©bloquÃ© | "Vous avez dÃ©bloquÃ© X" |
| `joinApproved` | AdhÃ©sion acceptÃ©e | "Bienvenue dans X" |

### IntÃ©grations

| Ã‰vÃ©nement | Fichier | Notification |
|-----------|---------|--------------|
| Match enregistrÃ© | `src/app/api/matches/route.ts` | Push Ã  l'adversaire |
| Match Now crÃ©Ã© | `src/lib/match-now/service.ts` | Push aux joueurs compatibles |
| Match Now rÃ©ponse | `src/lib/match-now/service.ts` | Push au crÃ©ateur |

### Schema Base de DonnÃ©es

```sql
CREATE TABLE push_subscriptions (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES players(id) ON DELETE CASCADE,
  endpoint TEXT UNIQUE NOT NULL,
  p256dh TEXT NOT NULL,
  auth TEXT NOT NULL,
  user_agent TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  last_used_at TIMESTAMP
);
```

---

## Configuration Requise

### Variables Netlify

```bash
# Sentry (recommandÃ©)
NEXT_PUBLIC_SENTRY_DSN=https://xxx@xxx.ingest.sentry.io/xxx
SENTRY_DSN=https://xxx@xxx.ingest.sentry.io/xxx

# Upstash Redis (optionnel)
UPSTASH_REDIS_REST_URL=https://xxx.upstash.io
UPSTASH_REDIS_REST_TOKEN=your_token

# Web Push (requis pour notifications)
NEXT_PUBLIC_VAPID_PUBLIC_KEY=BLxxxxxxxxxxxxxxxxxxxxxxxx
VAPID_PRIVATE_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxx
VAPID_SUBJECT=mailto:pleneuftrading@gmail.com
```

### GÃ©nÃ©ration des clÃ©s VAPID

```bash
npx web-push generate-vapid-keys
```

---

## RÃ©capitulatif des PrioritÃ©s

### TerminÃ© Cette Session

| PrioritÃ© | TÃ¢che | ICE | Statut |
|----------|-------|-----|--------|
| P0 | Build Netlify | - | âœ… CorrigÃ© |
| P0 | Rate Limiting | 27 | âœ… 4 routes protÃ©gÃ©es |
| P1 | Sentry Monitoring | 24 | âœ… Client + Server + Edge |
| P1 | Tests E2E | 24 | âœ… Structure Playwright |
| P1 | Nouveau Logo | - | âœ… Branding complet |
| P2 | Push Notifications | 20 | âœ… ImplÃ©mentÃ© |

### Prochaines PrioritÃ©s

| PrioritÃ© | TÃ¢che | ICE | Effort |
|----------|-------|-----|--------|
| P2 | Mode hors-ligne amÃ©liorÃ© | 18 | 1j |
| P2 | Dashboard analytics admin | 16 | 2-3j |
| P3 | Challenges hebdomadaires | 65 | 5j |
| P3 | Chat 1-to-1 amÃ©liorÃ© | 55 | 3j |

---

## Statistiques de la Session

```
Commits          : 5 (cette partie)
Fichiers crÃ©Ã©s   : 25
Fichiers modifiÃ©s: 35
Lignes ajoutÃ©es  : ~2,500
Lignes supprimÃ©es: ~100
DÃ©pendances      : +4 (web-push, @sentry/nextjs, @upstash/*)
Temps total      : ~6h
```

---

## DÃ©pendances AjoutÃ©es

### Production

```json
{
  "@sentry/nextjs": "^10.34.0",
  "@upstash/ratelimit": "^2.0.8",
  "@upstash/redis": "^1.36.1",
  "web-push": "^3.x"
}
```

### DÃ©veloppement

```json
{
  "@playwright/test": "^1.57.0",
  "@types/web-push": "^3.x"
}
```

---

## Liens Utiles

- **Repository** : https://github.com/PleneufMC/TennisMatchFinder
- **Production** : https://tennismatchfinder.net
- **Dernier commit** : `50f0876`

### Documentation AssociÃ©e

- `docs/AUDIT_COMPETITIVE_GAP.md` - Analyse concurrentielle
- `docs/PROJECT_STATUS_CENTRAL.md` - Ã‰tat du projet
- `docs/ROADMAP_RECOMMENDATION.md` - Feuille de route

---

*Document mis Ã  jour le 18 janvier 2026*
